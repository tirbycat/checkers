<!DOCTYPE html>

<html lang="ru" ng-app>
    <head>
        <title></title>
        <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap-responsive.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/main.css">
        <script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
        <script src="js/angular.min.js" type="text/javascript"></script>
        <script src="js/bootstrap.js" type="text/javascript"></script>
        <script src="js/code.js"></script>
    </head>
    <body>
        #if($session.userid)
            <div class="container" ng-controller="DataCtrl">
                $logoutLnk

                <ul>   
                    <li ng-repeat="row in games">
                        <a href="#" ng-click="SelectGame(row)">{{row}}</a>
                    </li>
                </ul>
                <a href="#" ng-click="addNewGame()">add new game</a>
                <script type="text/javascript">
                    #set($angularhttp="$http")
                    function DataCtrl($scope, $routeParams, $angularhttp) {
                        var getGamesReq = {
                            action: "getusergames",
                            parameters: {}
                        };
                        
                        $angularhttp
                            .get("/checkersapi?json=" + JSON.stringify(getGamesReq), $routeParams).success(function(data) {
                            $scope.games = data.ids;
                        });

                        $scope.addNewGame = function(){
                            var addNewGameReq = {
                                action: "newgame",
                                parameters: {}
                            };
                            $angularhttp
                                .get("/checkersapi?json=" + JSON.stringify(addNewGameReq)).success(function(data) {
                                $scope.games[$scope.games.length] = data.gameid;
                            });
                        }
                        
                        $scope.SelectGame = function(gameid){
                            var selectGameReq = {
                                action: "getgame",
                                parameters: {
                                    gameid: gameid
                                }
                            };
                            
                            $angularhttp
                                .get("/checkersapi?json=" + JSON.stringify(selectGameReq)).success(function(data) {
                                $scope.currentGame = data;
                            });                            
                        }
                    }

                </script>
            </div>
        #else
            <div class="container">
                $loginForm.startTag()
                    <h2 class="form-signin-heading">Please sign in</h2>
                    #set ($message = $session.message)
                    #if ($message)
                        <div class="alert alert-error">
                            $message
                        </div>
                    #end 
                    <input class="input-block-level" type="text" name="login" value="#if($login)$login#end" placeholder="Login">
                    <input class="input-block-level" type="password" name="password" placeholder="Password">
                    <label class="checkbox">
                        <input type="checkbox" value="remember-me">
                        Remember me
                    </label>
                    
                    $loginForm.fields.loginButton
                $loginForm.endTag()
            </div>
        #end
    </body>
</html>